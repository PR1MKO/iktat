{% extends "base.html" %}
{% import 'includes/case_macros.html' as cm %}

{% block title %}SzakÃ©rtÅ‘ KezdÅ‘lap â€“ CaseTracker{% endblock %}

{% block content %}
<div class="card-body d-flex align-items-center py-3">
  <i class="bi bi-person-check fs-3 me-3 text-primary"></i>
  <div>
    <h3 class="h4 mb-0"><small>KezdÅ‘lap:</small> SzakÃ©rtÅ‘</h4>
  </div>
</div>

<p><a class="btn btn-outline-secondary" href="{{ url_for('main.ugyeim') }}">ğŸ—‚ Ãœgyeim</a></p>

<hr>

<div class="card mb-4">
  <div class="card-header fw-bold">ğŸ§­ Feladataim:</div>
  <div class="card-body">
    {% if task_messages %}
      <ul class="list-unstyled mb-0">
        {% for msg in task_messages %}
          <li class="mb-2">
            <strong>{{ msg.case.case_number }}</strong> {{ msg.message|replace(msg.case.case_number, '')|trim }}
            <small class="text-muted ms-2">[{{ msg.timestamp.strftime('%Y-%m-%d %H:%M') }} â€“ {{ msg.case.last_modified_by }}]</small>
            <a href="{{ url_for('auth.view_case', case_id=msg.case_id) }}" class="btn btn-sm btn-outline-primary ms-2">MegnyitÃ¡s</a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted mb-0">Nincs megjelenÃ­tendÅ‘ Ã¼gy.</p>
    {% endif %}
  </div>
</div>

<div class="row mb-4 g-3">
  <div class="col-md-6">
    {{ cm.dashboard_card(
      'ğŸ—“ KÃ¶zelgÅ‘ hatÃ¡ridÅ‘k (14 napon belÃ¼l)',
      upcoming_deadlines
    ) }}
  </div>
</div>

<div class="row mb-4 g-3">
	<div class="col-md-6">
	  {{ cm.dashboard_card(
		'ğŸ“Š Gyors statisztikÃ¡k',
		items=[
		  ('Ãšj Ã¼gyek ma', new_today),
		  ('Ãšj Ã¼gyek ezen a hÃ©ten', new_this_week),
		  ('Ãšj Ã¼gyek ebben a hÃ³napban', new_this_month),
		  ('Nyitott Ã¼gyek', total_open),
		  ('LezÃ¡rt Ã¼gyek', closed_cases)
		]
	  ) }}
	</div>
  <div class="col-md-6">
    {{ cm.dashboard_card(
      'ğŸŸ¡ Ãllapot szerinti bontÃ¡s',
      items=status_counts_list
    ) }}
  </div>
</div>

{% endblock %}
