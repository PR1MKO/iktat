{% extends "base.html" %}
{% import 'includes/case_macros.html' as cm %}
{% block sidebar %}{% endblock %}

{% block content %}
<div class="container pt-2 pb-4">
  <div class="row">
    <div class="col-md-12 mb-3">
      {{ cm.alapadatok(case) }}
    </div>
  </div>

  <div class="row">
    <div class="col-md-12 mb-3">
      {{ cm.orders_block(case.tox_orders) }}
    </div>
  </div>

  <div class="row">
    <div class="col-md-12 mb-3">
      {% set upload_url = url_for('auth.upload_file', case_id=case.id) %}
      {% set categories = [
          ('tox_lelet', 'toxikológiai lelet'),
          ('végzés', 'végzés'),
          ('egyéb', 'egyéb')
        ] %}
      {{ cm.file_upload_block(upload_url, 'file', 'tox-file-upload', True, 'Fájl feltöltése', 'Feltöltés', {}, categories) }}
    </div>
    <div class="col-md-12 mb-3">
      {{ cm.uploaded_files(case) }}
    </div>
  </div>

  <!-- Toxicology Document Generation -->
  <div class="mt-4">
    <form method="post" action="{{ url_for('auth.generate_tox_doc', case_id=case.id) }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <input type="hidden" name="alkohol_minta_ara" value="2500">
      <input type="hidden" name="osszesen_ara" value="0">
      <button class="btn btn-outline-primary" type="submit">
        <i class="bi bi-file-earmark-word me-2"></i> Toxikológiai kirendelő generálása
      </button>
    </form>
  </div>

  <form method="post" class="row g-3 needs-validation" novalidate>
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    {{ cm.notes_ajax_block(case) }}
    <div class="col-12 d-flex gap-2">
      <button type="submit" class="btn btn-success">Elvégezve</button>
      <a href="{{ url_for('main.toxi_ugyeim') }}" class="btn btn-outline-secondary">Mégse</a>
    </div>
  </form>
</div>
{% endblock %}